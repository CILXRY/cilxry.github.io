---
// 1. 获取当前请求的文章
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import BasePageLayout from "../../layouts/basePageLayout.astro";

// 2. 在 getStaticPaths 中获取所有文章
export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  return allPosts.map((post) => ({
    params: { slug: post.slug },
  }));
}

// 3. 获取当前 slug 对应的文章
const { slug } = Astro.params;
const allPosts = await getCollection("blog"); // 重复一次，用于渲染
const post = allPosts.find((p) => p.slug === slug);

// 4. 如果找不到或草稿，重定向
if (!post || post.data.draft) {
  return Astro.redirect("/404");
}

// 5. 渲染 Markdown 内容
const { Content } = await post.render();
---

<BasePageLayout>
  <article class="post-content">
    <header>
      <h1 class="post-title">{post.data.title}</h1>
      <time datetime={post.data.pubDate.toISOString()}>
        {post.data.pubDate.toLocaleDateString("zh-CN")}
      </time>
    </header>
    <div class="post-body">
      <Content />
    </div>
  </article>
</BasePageLayout>

<style scoped>
  .post-content{
    max-width: 768px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    line-height: 1.8;
    color: #ccc;
  }

  .post-title{
    font-size: 2.2rem ;
    font-weight: 700;
    margin-bottom: 0.8rem;
    line-height: 1.3;
    color: #2c3e50;
  }

  .post-body img{
    max-width: 100%;
    height: auto;
    margin: 1.5rem auto;;
    display: block;
    border-radius: 4px;
  }
</style>